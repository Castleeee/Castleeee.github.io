<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Docker🐳 | 会走路的三百块</title>
    <meta name="description" content="年轻人的博客">
    <link rel="icon" href="/logo1.ico" type="image/x-icon">
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.d22626bb.css" as="style"><link rel="preload" href="/assets/js/app.64171550.js" as="script"><link rel="preload" href="/assets/js/10.f30e4bf5.js" as="script"><link rel="preload" href="/assets/js/38.34e99c36.js" as="script"><link rel="prefetch" href="/assets/js/100.14a8b555.js"><link rel="prefetch" href="/assets/js/101.9e257240.js"><link rel="prefetch" href="/assets/js/11.c050169c.js"><link rel="prefetch" href="/assets/js/12.9abd0678.js"><link rel="prefetch" href="/assets/js/13.ca763ee5.js"><link rel="prefetch" href="/assets/js/14.69f05fca.js"><link rel="prefetch" href="/assets/js/15.db5225be.js"><link rel="prefetch" href="/assets/js/16.c6de58f6.js"><link rel="prefetch" href="/assets/js/17.a33727a2.js"><link rel="prefetch" href="/assets/js/18.78f0824a.js"><link rel="prefetch" href="/assets/js/19.20a4f3cf.js"><link rel="prefetch" href="/assets/js/20.15fb9aec.js"><link rel="prefetch" href="/assets/js/21.c2410e24.js"><link rel="prefetch" href="/assets/js/22.6423d49a.js"><link rel="prefetch" href="/assets/js/23.1b0b2120.js"><link rel="prefetch" href="/assets/js/24.93132bac.js"><link rel="prefetch" href="/assets/js/25.a334198a.js"><link rel="prefetch" href="/assets/js/26.c1c7aaa3.js"><link rel="prefetch" href="/assets/js/27.2c86a0cd.js"><link rel="prefetch" href="/assets/js/28.a9d5d0ae.js"><link rel="prefetch" href="/assets/js/29.82f2e489.js"><link rel="prefetch" href="/assets/js/3.465cd447.js"><link rel="prefetch" href="/assets/js/30.d0c8250c.js"><link rel="prefetch" href="/assets/js/31.e6286844.js"><link rel="prefetch" href="/assets/js/32.116769da.js"><link rel="prefetch" href="/assets/js/33.38e22b91.js"><link rel="prefetch" href="/assets/js/34.21d15ece.js"><link rel="prefetch" href="/assets/js/35.53517849.js"><link rel="prefetch" href="/assets/js/36.9b848dcf.js"><link rel="prefetch" href="/assets/js/37.bf3574bb.js"><link rel="prefetch" href="/assets/js/39.10a54121.js"><link rel="prefetch" href="/assets/js/4.9d750d27.js"><link rel="prefetch" href="/assets/js/40.0ead9dc2.js"><link rel="prefetch" href="/assets/js/41.16bfab2f.js"><link rel="prefetch" href="/assets/js/42.b0388f8b.js"><link rel="prefetch" href="/assets/js/43.1d51bbcb.js"><link rel="prefetch" href="/assets/js/44.9e15a8ac.js"><link rel="prefetch" href="/assets/js/45.c9a7ee30.js"><link rel="prefetch" href="/assets/js/46.0821d6b3.js"><link rel="prefetch" href="/assets/js/47.fdd4b2c4.js"><link rel="prefetch" href="/assets/js/48.c86a3241.js"><link rel="prefetch" href="/assets/js/49.29d7cdaf.js"><link rel="prefetch" href="/assets/js/5.b5540d72.js"><link rel="prefetch" href="/assets/js/50.88cae993.js"><link rel="prefetch" href="/assets/js/51.39b0672d.js"><link rel="prefetch" href="/assets/js/52.47b9c89c.js"><link rel="prefetch" href="/assets/js/53.561866dc.js"><link rel="prefetch" href="/assets/js/54.44ad8aef.js"><link rel="prefetch" href="/assets/js/55.999cd3f5.js"><link rel="prefetch" href="/assets/js/56.0fc25a14.js"><link rel="prefetch" href="/assets/js/57.fbeec51d.js"><link rel="prefetch" href="/assets/js/58.c2c3e960.js"><link rel="prefetch" href="/assets/js/59.388b8a2f.js"><link rel="prefetch" href="/assets/js/6.9305fa77.js"><link rel="prefetch" href="/assets/js/60.3bab7106.js"><link rel="prefetch" href="/assets/js/61.fab74e1f.js"><link rel="prefetch" href="/assets/js/62.b8451d9d.js"><link rel="prefetch" href="/assets/js/63.1ea19cc7.js"><link rel="prefetch" href="/assets/js/64.21f37b67.js"><link rel="prefetch" href="/assets/js/65.79da4678.js"><link rel="prefetch" href="/assets/js/66.2276f1ea.js"><link rel="prefetch" href="/assets/js/67.cf3e97e4.js"><link rel="prefetch" href="/assets/js/68.3b9433a6.js"><link rel="prefetch" href="/assets/js/69.a6723b19.js"><link rel="prefetch" href="/assets/js/7.8235c05c.js"><link rel="prefetch" href="/assets/js/70.eff0cc02.js"><link rel="prefetch" href="/assets/js/71.577ad016.js"><link rel="prefetch" href="/assets/js/72.ee1b8084.js"><link rel="prefetch" href="/assets/js/73.ce23853b.js"><link rel="prefetch" href="/assets/js/74.e51d0dc7.js"><link rel="prefetch" href="/assets/js/75.3fbf6e41.js"><link rel="prefetch" href="/assets/js/76.1ad79723.js"><link rel="prefetch" href="/assets/js/77.05aaa2f4.js"><link rel="prefetch" href="/assets/js/78.9e4bf317.js"><link rel="prefetch" href="/assets/js/79.028f9c41.js"><link rel="prefetch" href="/assets/js/8.a4265244.js"><link rel="prefetch" href="/assets/js/80.a83e9fee.js"><link rel="prefetch" href="/assets/js/81.e20ef630.js"><link rel="prefetch" href="/assets/js/82.0a2c28d1.js"><link rel="prefetch" href="/assets/js/83.84f22d3a.js"><link rel="prefetch" href="/assets/js/84.8c0c443d.js"><link rel="prefetch" href="/assets/js/85.1473a2e2.js"><link rel="prefetch" href="/assets/js/86.4683653f.js"><link rel="prefetch" href="/assets/js/87.9507aa61.js"><link rel="prefetch" href="/assets/js/88.77ce595e.js"><link rel="prefetch" href="/assets/js/89.d25806a8.js"><link rel="prefetch" href="/assets/js/9.56b90d44.js"><link rel="prefetch" href="/assets/js/90.231b245f.js"><link rel="prefetch" href="/assets/js/91.cb1ec410.js"><link rel="prefetch" href="/assets/js/92.10cedbd9.js"><link rel="prefetch" href="/assets/js/93.575cc043.js"><link rel="prefetch" href="/assets/js/94.9233e13a.js"><link rel="prefetch" href="/assets/js/95.fafa9bc4.js"><link rel="prefetch" href="/assets/js/96.8b941223.js"><link rel="prefetch" href="/assets/js/97.49080105.js"><link rel="prefetch" href="/assets/js/98.82d1cc72.js"><link rel="prefetch" href="/assets/js/99.d78b0b9a.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.0cd5f832.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d22626bb.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><div><header id="navbarWrapper" class="navbar"><div class="sidebar-button"><i class="iconfont reco-menu"></i></div> <a href="/" class="home-link router-link-active"><img src="/head3.png" alt="会走路的三百块" class="logo"> <span class="site-name">会走路的三百块</span></a> <div class="links" style="max-width:nullpx;"><div class="side-search-wrapper"><div class="search-box" data-v-1b2e3b29><input aria-label="Search" autocomplete="off" spellcheck="false" value="" data-v-1b2e3b29> <i class="iconfont reco-search" data-v-1b2e3b29></i> <!----></div></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/backEnd.html" class="nav-link"><i class="iconfont undefined"></i>
  后端
</a></li><li class="dropdown-item"><!----> <a href="/categories/frontEnd.html" class="nav-link"><i class="iconfont undefined"></i>
  前端
</a></li><li class="dropdown-item"><!----> <a href="/categories/bigData.html" class="nav-link"><i class="iconfont undefined"></i>
  大数据
</a></li><li class="dropdown-item"><!----> <a href="/categories/Distributed.html" class="nav-link"><i class="iconfont undefined"></i>
  分布式
</a></li><li class="dropdown-item"><!----> <a href="/categories/life.html" class="nav-link"><i class="iconfont undefined"></i>
  日记
</a></li></ul></div></div><div class="nav-item"><a href="/tags/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tags
</a></div><div class="nav-item"><a href="/categories/article.html" class="nav-link"><i class="iconfont reco-up"></i>
  Library
</a></div><div class="nav-item"><a href="/timeLine/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="/about.html" class="nav-link"><i class="iconfont reco-account"></i>
  about me
</a></div><div class="nav-item"><a href="https://www.jianshu.com/u/04777e91e2ef" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-jianshu"></i>
  简书
  </a></div><div class="nav-item"><a href="https://github.com/Castleeee" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  </a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><div class="side-search-wrapper"><div class="search-box" data-v-1b2e3b29><input aria-label="Search" autocomplete="off" spellcheck="false" value="" data-v-1b2e3b29> <i class="iconfont reco-search" data-v-1b2e3b29></i> <!----></div></div> <nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/backEnd.html" class="nav-link"><i class="iconfont undefined"></i>
  后端
</a></li><li class="dropdown-item"><!----> <a href="/categories/frontEnd.html" class="nav-link"><i class="iconfont undefined"></i>
  前端
</a></li><li class="dropdown-item"><!----> <a href="/categories/bigData.html" class="nav-link"><i class="iconfont undefined"></i>
  大数据
</a></li><li class="dropdown-item"><!----> <a href="/categories/Distributed.html" class="nav-link"><i class="iconfont undefined"></i>
  分布式
</a></li><li class="dropdown-item"><!----> <a href="/categories/life.html" class="nav-link"><i class="iconfont undefined"></i>
  日记
</a></li></ul></div></div><div class="nav-item"><a href="/tags/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tags
</a></div><div class="nav-item"><a href="/categories/article.html" class="nav-link"><i class="iconfont reco-up"></i>
  Library
</a></div><div class="nav-item"><a href="/timeLine/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="/about.html" class="nav-link"><i class="iconfont reco-account"></i>
  about me
</a></div><div class="nav-item"><a href="https://www.jianshu.com/u/04777e91e2ef" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-jianshu"></i>
  简书
  </a></div><div class="nav-item"><a href="https://github.com/Castleeee" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  </a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><!----></p> <ul class="sidebar-group-items"><li><a href="/blog/distribute/Docker.html#🐳" class="sidebar-link">🐳</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/distribute/Docker.html#安装与启动" class="sidebar-link">安装与启动</a></li><li class="sidebar-sub-header"><a href="/blog/distribute/Docker.html#基本命令" class="sidebar-link">基本命令</a></li><li class="sidebar-sub-header"><a href="/blog/distribute/Docker.html#dcokerfile" class="sidebar-link">dcokerfile</a></li><li class="sidebar-sub-header"><a href="/blog/distribute/Docker.html#分层存储" class="sidebar-link">分层存储</a></li><li class="sidebar-sub-header"><a href="/blog/distribute/Docker.html#volume" class="sidebar-link">volume</a></li><li class="sidebar-sub-header"><a href="/blog/distribute/Docker.html#镜像仓库" class="sidebar-link">镜像仓库</a></li><li class="sidebar-sub-header"><a href="/blog/distribute/Docker.html#持久化" class="sidebar-link">持久化</a></li></ul></li><li><a href="/blog/distribute/Docker.html#⚓" class="sidebar-link">⚓</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/distribute/Docker.html#windows安装" class="sidebar-link">windows安装</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/distribute/Docker.html#安装k8s" class="sidebar-link">安装k8s</a></li><li class="sidebar-sub-header"><a href="/blog/distribute/Docker.html#配置-kubernetes-控制台" class="sidebar-link">配置 Kubernetes 控制台</a></li><li class="sidebar-sub-header"><a href="/blog/distribute/Docker.html#创建token" class="sidebar-link">创建token</a></li><li class="sidebar-sub-header"><a href="/blog/distribute/Docker.html#安装rancher" class="sidebar-link">安装Rancher</a></li></ul></li><li><a href="/blog/distribute/Docker.html#引用参考" class="sidebar-link">引用参考</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li></ul> </div> <div class="page" data-v-cdcae5a4> <div class="page-title" data-v-cdcae5a4><h1 data-v-cdcae5a4>Docker🐳</h1> <hr data-v-cdcae5a4> <div data-v-2c25cede data-v-cdcae5a4><i class="iconfont reco-account" data-v-2c25cede><span data-v-2c25cede>会走路的三百块</span></i> <i class="iconfont reco-date" data-v-2c25cede><span data-v-2c25cede>2/10/2019</span></i> <!----> <i class="iconfont reco-tag tags" data-v-2c25cede><span class="tag-item" data-v-2c25cede>
      容器技术
    </span><span class="tag-item" data-v-2c25cede>
      分布式
    </span><span class="tag-item" data-v-2c25cede>
      linux🐧
    </span><span class="tag-item" data-v-2c25cede>
      所有文章
    </span></i></div></div> <div class="content" data-v-cdcae5a4><div align="center"><h1>Docker🐳</h1> <br> <p>docker架构网上一大把，文档里也有主要介绍常用命令和使用中遇到的问题<br>
被linux各种奇奇怪怪的错误折磨疯了<br> 用了docker一时爽，一直用docker一直爽！</p></div> <h2 id="🐳"><a href="#🐳" aria-hidden="true" class="header-anchor">#</a> 🐳</h2> <h3 id="安装与启动"><a href="#安装与启动" aria-hidden="true" class="header-anchor">#</a> 安装与启动</h3> <p>windows下安装需要在BIOS中启动虚拟化和Hyper-v。无脑下一步就行<br>
linux <a href="https://www.cnblogs.com/yufeng218/p/8370670.html">这是centos</a> <br>
启动服务:sudo service docker start<br>
先试一下:docker run ubuntu echo hello docker<br>
hello docker<br> <a href="https://hub.daocloud.io/">国内的镜像</a></p> <h3 id="基本命令"><a href="#基本命令" aria-hidden="true" class="header-anchor">#</a> 基本命令</h3> <div class="warning custom-block"><p class="custom-block-title">WARNING</p> <p>可以把每个 container 看做是一个独立的主机,container 一旦创建如果没有用 rm 命令移除，将会一直存在。所以用完后记得删除</p></div> <ul><li><p>docker info 查看本机上docker的信息</p></li> <li><p>docker version 查看docker的版本</p></li> <li><p>docker login/logout登陆/登出</p></li> <li><p>docker images 查看镜像可以跟name</p> <ul><li><p>-a 列出所有镜像（含过程镜像）；</p></li> <li><p>-f 过滤镜像，如： -f ['dangling=true'] 只列出满足dangling=true 条件的镜像；</p></li> <li><p>--no-trunc 可显示完整的镜像ID；</p></li> <li><p>-q 仅列出镜像ID。</p></li> <li><p>--tree 以树状结构列出镜像的所有提交历史。</p></li></ul></li> <li><p>docker run -p 8080:80 -d xxx  容器运行指定的image,将镜像的80映射到本机的8080，-d意思是直接返回不阻塞</p> <ul><li>-i - t 进入命令行</li></ul></li></ul> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>映射端口docker run -d -p 80:80 -p 22:22<br>
进入命令行docker run -i - t xxxx (注意有个空格)/bin/bash</p></div> <ul><li><p>docker ps 查看当前正在运行的容器的信息<br>
列出所有运行中容器。</p> <ul><li><p>-a 列出所有容器（含沉睡镜像）；</p></li> <li><p>--before=&quot;nginx&quot; 列出在某一容器之前创建的容器，接受容器名称和ID作为参数；</p></li> <li><p>--since=&quot;nginx&quot; 列出在某一容器之后创建的容器，接受容器名称和ID作为参数；</p></li> <li><p>-f [exited=int] 列出满足exited=int条件的容器；</p></li> <li><p>-l 最新创建的一个容器；</p></li> <li><p>--no-trunc 显示完整的容器ID；</p></li> <li><p>-n=4 列出最近创建的4个容器；</p></li> <li><p>-q 仅列出容器ID；</p></li> <li><p>-s 显示容器大小。<br></p> <pre><code> [root@izuf6720onwdpnl2xfy65lz ~]# docker ps
 CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                  NAMES
 28ee7cbe79da        docker.io/nginx     &quot;nginx -g 'daemon ...&quot;   53 seconds ago      Up 52 seconds       0.0.0.0:8081-&gt;80/tcp   goofy_ritchie
</code></pre></li></ul></li> <li><p>docker cp file.txt 28ee7cbe79da(容器id)：//usr/share/nginx/html 将file.txt复制到该容器的指定目录</p></li> <li><p>ctrl+Q+P退出容器</p></li></ul> <div class="warning custom-block"><p class="custom-block-title">WARNING</p> <p>你所做的对容器内部的更改docker不会保存，需要用命令commit</p></div> <ul><li>docker commit -m &quot;commit信息&quot; imageid 保存的image的名字</li> <li>docker rmi imageid 删掉image</li> <li>docker rm imageid 删掉image可以删除历史
<ul><li><p>-f 强行移除该容器，即使其正在运行</p></li> <li><p>-l 让该镜像断网</p></li> <li><p>-v 移除与容器关联的空间</p></li></ul></li> <li>docker /stop imageid 启动/停止/重启 一个image
<ul><li><p>-i 启动一个容器并进入交互模式操控该镜像的命令行</p></li> <li><p>-t 10 停止或者重启容器的超时时间（秒），超时后系统将杀死进程。</p></li></ul></li> <li>docker inspect</li> <li>docker history imageid 查看历史
<ul><li><p>--no-trunc 显示完整的提交记录；</p></li> <li><p>-q 仅列出提交记录ID。</p></li></ul></li> <li>docker pull xxx 获取image</li> <li>docker build + path 把这个路径下所有的文件打包成一个dockerimage
<ul><li>-t xxx 附加这个image的标签</li></ul></li> <li>docker push 推送dockerimage</li> <li>docker exec -it 容器id或name /bin/bash 进入容器的命令行用attach的时候推出会直接结束容器</li></ul> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>docker rm <code>docker ps -a -q</code>删除所有的容器<br>
docker rmi <code>docker images -q</code>删除所有镜像<br>
docker rmi <code>docker images -q | awk '/^&lt;none&gt;/ { print $3 }'</code>按条件删除镜像<br>
docker rmi --force <code>docker images | grep doss-api | awk '{print $3}'</code>按条件删除镜像其中doss-api为关键字<br></p></div> <h3 id="dcokerfile"><a href="#dcokerfile" aria-hidden="true" class="header-anchor">#</a> dcokerfile</h3> <table><thead><tr><th style="text-align:left">命令</th> <th style="text-align:right">用途</th></tr></thead> <tbody><tr><td style="text-align:left">FROM</td> <td style="text-align:right">base image</td></tr> <tr><td style="text-align:left">RUN</td> <td style="text-align:right">执行命令</td></tr> <tr><td style="text-align:left">ADD</td> <td style="text-align:right">添加文件</td></tr> <tr><td style="text-align:left">COPY</td> <td style="text-align:right">拷贝文件</td></tr> <tr><td style="text-align:left">ADD</td> <td style="text-align:right">可以添加远程文件和本机文件</td></tr> <tr><td style="text-align:left">CMD</td> <td style="text-align:right">执行命令</td></tr> <tr><td style="text-align:left">EXPOSE</td> <td style="text-align:right">暴露端口</td></tr></tbody></table> <h3 id="分层存储"><a href="#分层存储" aria-hidden="true" class="header-anchor">#</a> 分层存储</h3> <p>运行docker image时候，不同的容器可能只读共享一个image，当运行起来之后上面每个容器的状态不保存，commit会产生改过的新容器</p> <h3 id="volume"><a href="#volume" aria-hidden="true" class="header-anchor">#</a> volume</h3> <p>独立与容器外提供持久化存储，容器之间共享</p> <ul><li><p>docker run -d --name -v 容器内部的一个路径 nginx(imageName)挂载了一个路径。<br>
docker inspect nginx(name)进行访问</p> <pre><code>      &quot;Mounts&quot;: [
                  {
                      &quot;Type&quot;: &quot;volume&quot;,
                      &quot;Name&quot;: &quot;f9bdb344eba8cf6667950ded15d5561e2624225703d0472d0432cfa4a3dcf742&quot;,
                      &quot;Source&quot;: &quot;/www/server/docker/volumes/f9bdb344eba8cf6667950ded15d5561e2624225703d0472d0432cfa4a3dcf742/_data&quot;,
                      &quot;Destination&quot;: &quot;/usr/share/nginx/html&quot;,
                      &quot;Driver&quot;: &quot;local&quot;,
                      &quot;Mode&quot;: &quot;&quot;,
                      &quot;RW&quot;: true,
                      &quot;Propagation&quot;: &quot;&quot;
                  }
</code></pre></li></ul> <p>注意source容器外和destination容器内<br></p> <ul><li>docker exec -i -t nginx(镜像名) /bin/bash(linux的bash路径)进入镜像内部</li> <li>docker run -p 8080:80 -d -v $PWD/a:/usr/share/nginx/html nginx
<ul><li>将内部的80映射到8080，将内部的/usr/share/nginx/html目录挂载到$PWD(当前工作目录)的a目录下</li></ul></li> <li>1.docker create -v $PWD/data:/var/mydata --name data_container ubuntu
<ul><li>以ubuntu为基础，创建一个容器。-v让这个容器的目录/var/mydata挂载到$PWD/data</li></ul></li> <li>2.docker run -it --volumes-from data_container ubuntu /bin/bash 运行ubuntu镜像和这个镜像互通(这个ubuntu的这个目录修改会同步到data_container和挂载的目录)</li></ul> <h3 id="镜像仓库"><a href="#镜像仓库" aria-hidden="true" class="header-anchor">#</a> 镜像仓库</h3> <p>docker daemon 管着container 和images，images是从Registry拉取的，默认是官方的dockerHub<br>
国内 aliyun 时速云 daocloud<br></p> <ul><li>docker search xxx搜索</li> <li>docker pull xxx拉取</li> <li>docker push xxx 推送到Registry</li> <li>docker tag aaa bbb改掉aaa的tags产生一个bbb</li></ul> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>docker容器的主线程（dockfile中CMD执行的命令）结束，容器会退出</p></div> <p>可以使用交互式启动<br> <code>docker run -i [CONTAINER_NAME or CONTAINER_ID]</code><br>
使用后台模式和tty选项<br> <code>docker run -dit [CONTAINER_NAME or CONTAINER_ID]</code><br>
docker调出后台容器<br> <code>docker attach [CONTAINER_NAME or CONTAINER_ID]</code><br>
退出时，使用[ctrl + D]和exit，这样会结束docker当前线程，容器结束，可以使用[ctrl + P][ctrl + Q]退出而不终止容器运行<br>
如下命令，会在指定容器中执行指定命令，[ctrl+D]退出后不会终止容器运行<br> <code>docker exec -it [CONTAINER_NAME or CONTAINER_ID] /bin/bash</code></p> <h3 id="持久化"><a href="#持久化" aria-hidden="true" class="header-anchor">#</a> 持久化</h3> <h2 id="⚓"><a href="#⚓" aria-hidden="true" class="header-anchor">#</a> ⚓</h2> <div align="center"><h1>K8s⚓Kubernetes</h1> <br> <p>利用k8s编排并且管理集群和分布式环境<br>
说白了就是用来数框框的😶</p></div> <h2 id="windows安装"><a href="#windows安装" aria-hidden="true" class="header-anchor">#</a> windows安装</h2> <p>说明:我是在windows下安装docker-desktop,然后通过docker-desktop安装自带的Kubernets,然后在WSL中安装kubectl</p> <h3 id="安装k8s"><a href="#安装k8s" aria-hidden="true" class="header-anchor">#</a> 安装k8s</h3> <p>在Windows下先安装好docker,记得暴露端口.</p> <ul><li><p>docker:19.03.4</p></li> <li><p>k8s:1.14.7(和docker对应就行)</p></li> <li><p>windows:1803+</p></li> <li><p>WSL:Ubuntu18.14</p> <br></li></ul> <p>国内基本都被屏蔽了,如果你直接Enable Kubernetes会一直下载不完成卡住不动,所以要下载两个G的镜像很不容易,阿里有个仓库可以用.</p> <div align="center"><img src="/assets/img/Snipaste_2019-12-26_20-17-25.91e28535.png" style="height: 450px"></div> <p>具体方法看<a href="https://github.com/AliyunContainerService/k8s-for-docker-desktop">这里</a><br>
下载对应版本的脚本,用powershell-admin进入,运行<code>.\load_images.ps1</code>
下载约2G好了之后退出docker客户端然后重新启动,Enable Kubernetes,他想下载就允许,过5分钟左右应该就好了<br>
之后在windows中可以正常查看,但是WSL中还没配置</p> <div align="center"><img src="/assets/img/Snipaste_2019-12-26_19-42-44.1857227e.png" style="height: 350px"></div> <p>下载这个东西网址在这<a href="https://storage.googleapis.com/kubernetes-release/release/v1.14.7/bin/linux/amd64/kubectl">https://storage.googleapis.com/kubernetes-release/release/v1.14.7/bin/linux/amd64/kubectl</a></p> <p>可以直接curl,大约50M下载完之后cp到自己WSL的~目录下</p> <ul><li><code>chmod +x kubectl</code></li> <li><code>sudo mv ./kubectl /usr/local/bin/kubectl</code></li> <li>之后要让 WSL 里的 kubectl 命令知道如何连接 Docker Desktop for Windows 启动的 Kubernetes 集群把 Docker Desktop for Windows 创建的集群的配置文件拷贝到 WSL 里的用户目录下：</li> <li><code>mkdir ~/.kube &amp;&amp; cp /c/Users/[USERNAME]/.kube/config ~/.kube</code></li></ul> <br> <div align="center"><img src="/assets/img/Snipaste_2019-12-26_19-43-26.0cb7105c.png" style="height: 250px"></div><br> <p>大功告成输入<code>kubectl cluster-info</code>,<code>kubectl get nodes</code>查看状态
<br></p><div align="center"><img src="/assets/img/Snipaste_2019-12-26_21-41-22.6032f76b.png" style="height: 120px"></div><br><p></p> <h3 id="配置-kubernetes-控制台"><a href="#配置-kubernetes-控制台" aria-hidden="true" class="header-anchor">#</a> 配置 Kubernetes 控制台</h3> <p>首先把下载的那个文件夹,里面有个sample文件夹和<strong>kubernetes-dashboard.yaml</strong>,移动到WSL里面去,为了整洁放到<code>.kube</code>下<br> <br></p> <ul><li><code>cp /e/ooowl/Download/k8s-for-docker-desktop-1.14.7/sample .</code></li> <li><code>kubectl create -f kubernetes-dashboard.yaml</code></li> <li>开启代理<code>kubectl proxy</code>,不过一旦结束ssh会话就会停止</li> <li>可以放后台<code>nohup kubectl proxy &gt; .kube/log/kubeDashboard.log 2&gt;&amp;1 &amp;</code>,日志放在<code>.kube/log/kubeDashboard.log</code>,不用的时候kill -9 PID</li></ul> <br> <div align="center"><img src="/assets/img/Snipaste_2019-12-26_21-56-55.2cb2894e.png" style="height: 350px"></div><br> <div class="warning custom-block"><p class="custom-block-title">WARNING</p> <p>kubectl的版本一定要和K8s版本对应,都则会报错<br> <code>error: SchemaError(io.k8s.api.authentication.v1.TokenReviewStatus): invalid object doesn't have additional properties</code></p></div> <p>访问<strong>url</strong> <a href="http://localhost:8001/api/v1/namespaces/kube-system/services/https:kubernetes-dashboard:/proxy/#!/overview?namespace=default">http://localhost:8001/api/v1/namespaces/kube-system/services/https:kubernetes-dashboard:/proxy/#!/overview?namespace=default</a></p> <h3 id="创建token"><a href="#创建token" aria-hidden="true" class="header-anchor">#</a> 创建token</h3> <div class="language- extra-class"><pre class="language-text"><code>TOKEN=$(kubectl -n kube-system describe secret default| awk '$1==&quot;token:&quot;{print $2}')

kubectl config set-credentials docker-for-desktop --token=&quot;${TOKEN}&quot;

echo $TOKEN
</code></pre></div><p><strong>可能每次打开都需要</strong> <br></p><div align="center"><img src="/assets/img/Snipaste_2019-12-26_22-31-29.24fe72a0.png" style="height: 400px"></div><br><p></p> <h3 id="安装rancher"><a href="#安装rancher" aria-hidden="true" class="header-anchor">#</a> 安装Rancher</h3> <p>其实大家时间都不多,不可能把锁i有技术都学习一遍,学k8s也是拓展技术广度,所以简单易用快速达到目的是最好的.<br>
k8s用dashboard管理不大全,我发现了这个宝贝,虽然现在还处于比较早期,有些坑,我先在这里写,后面再补充.</p> <div class="warning custom-block"><p class="custom-block-title">WARNING</p> <p>本教程从k8s开始就本着不求甚解的态度,为的就是追求效果最大化</p></div> <p>好像是高级知识....先学学前置知识</p> <h2 id="引用参考"><a href="#引用参考" aria-hidden="true" class="header-anchor">#</a> 引用参考</h2> <ul><li>https://magicsong.github.io/2018/04/20/WSL-vscode%E5%8F%8C%E5%89%91%E5%90%88%E7%92%A7/</li> <li>https://zhuanlan.zhihu.com/p/85531874</li> <li>https://github.com/AliyunContainerService/k8s-for-docker-desktop</li> <li>https://stackoverflow.com/questions/55528603/kubectl-create-invalid-object/55530485</li> <li>https://kubesphere.com.cn/docs/v2.1/zh-CN/release/release-v210/</li> <li>https://juejin.im/post/5d89a2e3518825090d61c39e
<div id="vcomments"></div></li></ul></div> <!----> <!----> <!----> <div class="page-edit" data-v-cdcae5a4><!----> <div class="last-updated" data-v-cdcae5a4><span class="prefix" data-v-cdcae5a4>Last Updated: </span> <span class="time" data-v-cdcae5a4>12/29/2019, 3:00:55 PM</span></div></div> <!----> </div> <div class="valine-wrapper" data-v-63f18ac0><div id="valine" style="display:;" data-v-63f18ac0></div></div> <!----> <!----> <div class="back-to-ceiling" style="right:1rem;bottom:3rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;background-color:rgba(231, 234, 241,.5);display:none;" data-v-41016a8b data-v-41016a8b><i class="iconfont reco-up" data-v-41016a8b></i></div></div></div></div>
    <script src="/assets/js/app.64171550.js" defer></script><script src="/assets/js/10.f30e4bf5.js" defer></script><script src="/assets/js/38.34e99c36.js" defer></script>
  </body>
</html>
