<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>基础爬虫 | 会走路的三百块</title>
    <meta name="description" content="年轻人的博客">
    <link rel="icon" href="/logo1.ico" type="image/x-icon">
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.d22626bb.css" as="style"><link rel="preload" href="/assets/js/app.64171550.js" as="script"><link rel="preload" href="/assets/js/18.78f0824a.js" as="script"><link rel="preload" href="/assets/js/38.34e99c36.js" as="script"><link rel="prefetch" href="/assets/js/10.f30e4bf5.js"><link rel="prefetch" href="/assets/js/100.14a8b555.js"><link rel="prefetch" href="/assets/js/101.9e257240.js"><link rel="prefetch" href="/assets/js/11.c050169c.js"><link rel="prefetch" href="/assets/js/12.9abd0678.js"><link rel="prefetch" href="/assets/js/13.ca763ee5.js"><link rel="prefetch" href="/assets/js/14.69f05fca.js"><link rel="prefetch" href="/assets/js/15.db5225be.js"><link rel="prefetch" href="/assets/js/16.c6de58f6.js"><link rel="prefetch" href="/assets/js/17.a33727a2.js"><link rel="prefetch" href="/assets/js/19.20a4f3cf.js"><link rel="prefetch" href="/assets/js/20.15fb9aec.js"><link rel="prefetch" href="/assets/js/21.c2410e24.js"><link rel="prefetch" href="/assets/js/22.6423d49a.js"><link rel="prefetch" href="/assets/js/23.1b0b2120.js"><link rel="prefetch" href="/assets/js/24.93132bac.js"><link rel="prefetch" href="/assets/js/25.a334198a.js"><link rel="prefetch" href="/assets/js/26.c1c7aaa3.js"><link rel="prefetch" href="/assets/js/27.2c86a0cd.js"><link rel="prefetch" href="/assets/js/28.a9d5d0ae.js"><link rel="prefetch" href="/assets/js/29.82f2e489.js"><link rel="prefetch" href="/assets/js/3.465cd447.js"><link rel="prefetch" href="/assets/js/30.d0c8250c.js"><link rel="prefetch" href="/assets/js/31.e6286844.js"><link rel="prefetch" href="/assets/js/32.116769da.js"><link rel="prefetch" href="/assets/js/33.38e22b91.js"><link rel="prefetch" href="/assets/js/34.21d15ece.js"><link rel="prefetch" href="/assets/js/35.53517849.js"><link rel="prefetch" href="/assets/js/36.9b848dcf.js"><link rel="prefetch" href="/assets/js/37.bf3574bb.js"><link rel="prefetch" href="/assets/js/39.10a54121.js"><link rel="prefetch" href="/assets/js/4.9d750d27.js"><link rel="prefetch" href="/assets/js/40.0ead9dc2.js"><link rel="prefetch" href="/assets/js/41.16bfab2f.js"><link rel="prefetch" href="/assets/js/42.b0388f8b.js"><link rel="prefetch" href="/assets/js/43.1d51bbcb.js"><link rel="prefetch" href="/assets/js/44.9e15a8ac.js"><link rel="prefetch" href="/assets/js/45.c9a7ee30.js"><link rel="prefetch" href="/assets/js/46.0821d6b3.js"><link rel="prefetch" href="/assets/js/47.fdd4b2c4.js"><link rel="prefetch" href="/assets/js/48.c86a3241.js"><link rel="prefetch" href="/assets/js/49.29d7cdaf.js"><link rel="prefetch" href="/assets/js/5.b5540d72.js"><link rel="prefetch" href="/assets/js/50.88cae993.js"><link rel="prefetch" href="/assets/js/51.39b0672d.js"><link rel="prefetch" href="/assets/js/52.47b9c89c.js"><link rel="prefetch" href="/assets/js/53.561866dc.js"><link rel="prefetch" href="/assets/js/54.44ad8aef.js"><link rel="prefetch" href="/assets/js/55.999cd3f5.js"><link rel="prefetch" href="/assets/js/56.0fc25a14.js"><link rel="prefetch" href="/assets/js/57.fbeec51d.js"><link rel="prefetch" href="/assets/js/58.c2c3e960.js"><link rel="prefetch" href="/assets/js/59.388b8a2f.js"><link rel="prefetch" href="/assets/js/6.9305fa77.js"><link rel="prefetch" href="/assets/js/60.3bab7106.js"><link rel="prefetch" href="/assets/js/61.fab74e1f.js"><link rel="prefetch" href="/assets/js/62.b8451d9d.js"><link rel="prefetch" href="/assets/js/63.1ea19cc7.js"><link rel="prefetch" href="/assets/js/64.21f37b67.js"><link rel="prefetch" href="/assets/js/65.79da4678.js"><link rel="prefetch" href="/assets/js/66.2276f1ea.js"><link rel="prefetch" href="/assets/js/67.cf3e97e4.js"><link rel="prefetch" href="/assets/js/68.3b9433a6.js"><link rel="prefetch" href="/assets/js/69.a6723b19.js"><link rel="prefetch" href="/assets/js/7.8235c05c.js"><link rel="prefetch" href="/assets/js/70.eff0cc02.js"><link rel="prefetch" href="/assets/js/71.577ad016.js"><link rel="prefetch" href="/assets/js/72.ee1b8084.js"><link rel="prefetch" href="/assets/js/73.ce23853b.js"><link rel="prefetch" href="/assets/js/74.e51d0dc7.js"><link rel="prefetch" href="/assets/js/75.3fbf6e41.js"><link rel="prefetch" href="/assets/js/76.1ad79723.js"><link rel="prefetch" href="/assets/js/77.05aaa2f4.js"><link rel="prefetch" href="/assets/js/78.9e4bf317.js"><link rel="prefetch" href="/assets/js/79.028f9c41.js"><link rel="prefetch" href="/assets/js/8.a4265244.js"><link rel="prefetch" href="/assets/js/80.a83e9fee.js"><link rel="prefetch" href="/assets/js/81.e20ef630.js"><link rel="prefetch" href="/assets/js/82.0a2c28d1.js"><link rel="prefetch" href="/assets/js/83.84f22d3a.js"><link rel="prefetch" href="/assets/js/84.8c0c443d.js"><link rel="prefetch" href="/assets/js/85.1473a2e2.js"><link rel="prefetch" href="/assets/js/86.4683653f.js"><link rel="prefetch" href="/assets/js/87.9507aa61.js"><link rel="prefetch" href="/assets/js/88.77ce595e.js"><link rel="prefetch" href="/assets/js/89.d25806a8.js"><link rel="prefetch" href="/assets/js/9.56b90d44.js"><link rel="prefetch" href="/assets/js/90.231b245f.js"><link rel="prefetch" href="/assets/js/91.cb1ec410.js"><link rel="prefetch" href="/assets/js/92.10cedbd9.js"><link rel="prefetch" href="/assets/js/93.575cc043.js"><link rel="prefetch" href="/assets/js/94.9233e13a.js"><link rel="prefetch" href="/assets/js/95.fafa9bc4.js"><link rel="prefetch" href="/assets/js/96.8b941223.js"><link rel="prefetch" href="/assets/js/97.49080105.js"><link rel="prefetch" href="/assets/js/98.82d1cc72.js"><link rel="prefetch" href="/assets/js/99.d78b0b9a.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.0cd5f832.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d22626bb.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><div><header id="navbarWrapper" class="navbar"><div class="sidebar-button"><i class="iconfont reco-menu"></i></div> <a href="/" class="home-link router-link-active"><img src="/head3.png" alt="会走路的三百块" class="logo"> <span class="site-name">会走路的三百块</span></a> <div class="links" style="max-width:nullpx;"><div class="side-search-wrapper"><div class="search-box" data-v-1b2e3b29><input aria-label="Search" autocomplete="off" spellcheck="false" value="" data-v-1b2e3b29> <i class="iconfont reco-search" data-v-1b2e3b29></i> <!----></div></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/backEnd.html" class="nav-link"><i class="iconfont undefined"></i>
  后端
</a></li><li class="dropdown-item"><!----> <a href="/categories/frontEnd.html" class="nav-link"><i class="iconfont undefined"></i>
  前端
</a></li><li class="dropdown-item"><!----> <a href="/categories/bigData.html" class="nav-link"><i class="iconfont undefined"></i>
  大数据
</a></li><li class="dropdown-item"><!----> <a href="/categories/Distributed.html" class="nav-link"><i class="iconfont undefined"></i>
  分布式
</a></li><li class="dropdown-item"><!----> <a href="/categories/life.html" class="nav-link"><i class="iconfont undefined"></i>
  日记
</a></li></ul></div></div><div class="nav-item"><a href="/tags/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tags
</a></div><div class="nav-item"><a href="/categories/article.html" class="nav-link"><i class="iconfont reco-up"></i>
  Library
</a></div><div class="nav-item"><a href="/timeLine/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="/about.html" class="nav-link"><i class="iconfont reco-account"></i>
  about me
</a></div><div class="nav-item"><a href="https://www.jianshu.com/u/04777e91e2ef" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-jianshu"></i>
  简书
  </a></div><div class="nav-item"><a href="https://github.com/Castleeee" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  </a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><div class="side-search-wrapper"><div class="search-box" data-v-1b2e3b29><input aria-label="Search" autocomplete="off" spellcheck="false" value="" data-v-1b2e3b29> <i class="iconfont reco-search" data-v-1b2e3b29></i> <!----></div></div> <nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/backEnd.html" class="nav-link"><i class="iconfont undefined"></i>
  后端
</a></li><li class="dropdown-item"><!----> <a href="/categories/frontEnd.html" class="nav-link"><i class="iconfont undefined"></i>
  前端
</a></li><li class="dropdown-item"><!----> <a href="/categories/bigData.html" class="nav-link"><i class="iconfont undefined"></i>
  大数据
</a></li><li class="dropdown-item"><!----> <a href="/categories/Distributed.html" class="nav-link"><i class="iconfont undefined"></i>
  分布式
</a></li><li class="dropdown-item"><!----> <a href="/categories/life.html" class="nav-link"><i class="iconfont undefined"></i>
  日记
</a></li></ul></div></div><div class="nav-item"><a href="/tags/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tags
</a></div><div class="nav-item"><a href="/categories/article.html" class="nav-link"><i class="iconfont reco-up"></i>
  Library
</a></div><div class="nav-item"><a href="/timeLine/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="/about.html" class="nav-link"><i class="iconfont reco-account"></i>
  about me
</a></div><div class="nav-item"><a href="https://www.jianshu.com/u/04777e91e2ef" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-jianshu"></i>
  简书
  </a></div><div class="nav-item"><a href="https://github.com/Castleeee" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  </a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><!----></p> <ul class="sidebar-group-items"><li><a href="/blog/back/python/%E5%9F%BA%E7%A1%80%E7%88%AC%E8%99%AB.html#爬虫的基本原理" class="sidebar-link">爬虫的基本原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/back/python/%E5%9F%BA%E7%A1%80%E7%88%AC%E8%99%AB.html#请求" class="sidebar-link">请求</a></li><li class="sidebar-sub-header"><a href="/blog/back/python/%E5%9F%BA%E7%A1%80%E7%88%AC%E8%99%AB.html#处理" class="sidebar-link">处理</a></li><li class="sidebar-sub-header"><a href="/blog/back/python/%E5%9F%BA%E7%A1%80%E7%88%AC%E8%99%AB.html#存储" class="sidebar-link">存储</a></li><li class="sidebar-sub-header"><a href="/blog/back/python/%E5%9F%BA%E7%A1%80%E7%88%AC%E8%99%AB.html#去重" class="sidebar-link">去重</a></li></ul></li><li><a href="/blog/back/python/%E5%9F%BA%E7%A1%80%E7%88%AC%E8%99%AB.html#请求-2" class="sidebar-link">请求</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/back/python/%E5%9F%BA%E7%A1%80%E7%88%AC%E8%99%AB.html#requests" class="sidebar-link">requests</a></li><li class="sidebar-sub-header"><a href="/blog/back/python/%E5%9F%BA%E7%A1%80%E7%88%AC%E8%99%AB.html#selenium" class="sidebar-link">selenium</a></li><li class="sidebar-sub-header"><a href="/blog/back/python/%E5%9F%BA%E7%A1%80%E7%88%AC%E8%99%AB.html#aiohttp" class="sidebar-link">aiohttp</a></li></ul></li><li><a href="/blog/back/python/%E5%9F%BA%E7%A1%80%E7%88%AC%E8%99%AB.html#处理-2" class="sidebar-link">处理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/back/python/%E5%9F%BA%E7%A1%80%E7%88%AC%E8%99%AB.html#beautifulsoup" class="sidebar-link">BeautifulSoup</a></li><li class="sidebar-sub-header"><a href="/blog/back/python/%E5%9F%BA%E7%A1%80%E7%88%AC%E8%99%AB.html#pyquery" class="sidebar-link">pyQuery</a></li><li class="sidebar-sub-header"><a href="/blog/back/python/%E5%9F%BA%E7%A1%80%E7%88%AC%E8%99%AB.html#xpath-cssselector" class="sidebar-link">Xpath&amp;CssSelector</a></li></ul></li><li><a href="/blog/back/python/%E5%9F%BA%E7%A1%80%E7%88%AC%E8%99%AB.html#存储-2" class="sidebar-link">存储</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/back/python/%E5%9F%BA%E7%A1%80%E7%88%AC%E8%99%AB.html#pymysql" class="sidebar-link">pymysql</a></li><li class="sidebar-sub-header"><a href="/blog/back/python/%E5%9F%BA%E7%A1%80%E7%88%AC%E8%99%AB.html#pymongo" class="sidebar-link">PyMongo</a></li><li class="sidebar-sub-header"><a href="/blog/back/python/%E5%9F%BA%E7%A1%80%E7%88%AC%E8%99%AB.html#redis" class="sidebar-link">redis</a></li><li class="sidebar-sub-header"><a href="/blog/back/python/%E5%9F%BA%E7%A1%80%E7%88%AC%E8%99%AB.html#aiomysql" class="sidebar-link">aiomysql</a></li></ul></li><li><a href="/blog/back/python/%E5%9F%BA%E7%A1%80%E7%88%AC%E8%99%AB.html#scrapy" class="sidebar-link">Scrapy</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li></ul> </div> <div class="page" data-v-cdcae5a4> <div class="page-title" data-v-cdcae5a4><h1 data-v-cdcae5a4>基础爬虫</h1> <hr data-v-cdcae5a4> <div data-v-2c25cede data-v-cdcae5a4><i class="iconfont reco-account" data-v-2c25cede><span data-v-2c25cede>会走路的三百块</span></i> <i class="iconfont reco-date" data-v-2c25cede><span data-v-2c25cede>7/13/2018</span></i> <!----> <i class="iconfont reco-tag tags" data-v-2c25cede><span class="tag-item" data-v-2c25cede>
      爬虫🕷
    </span><span class="tag-item" data-v-2c25cede>
      后端
    </span><span class="tag-item" data-v-2c25cede>
      第三方库
    </span><span class="tag-item" data-v-2c25cede>
      python🐍
    </span><span class="tag-item" data-v-2c25cede>
      异步
    </span><span class="tag-item" data-v-2c25cede>
      所有文章
    </span></i></div></div> <div class="content" data-v-cdcae5a4><div class="tip custom-block"><p class="custom-block-title">基本知道的爬虫</p> <p>好多自己看吧</p></div> <h2 id="爬虫的基本原理"><a href="#爬虫的基本原理" aria-hidden="true" class="header-anchor">#</a> 爬虫的基本原理</h2> <p>基本就是三部分</p> <h3 id="请求"><a href="#请求" aria-hidden="true" class="header-anchor">#</a> 请求</h3> <p>请求就是http，把网页的源码下载到本地(内存)进行访问的，经常用的有urlib(太老一般只用到urljoin)，requests，scrapy(框架)，twisted(异步事件驱动)，aiohttp(异步)
请求一般用get(直接获取资源)post(表单验证)set等后面不常用<br>这里会涉及到反爬<br></p> <ul><li>对网站感兴趣,分析网络请求，用scrapy写爬虫爬取数据<br>
监控发现某个时间段访问陡增，ip相同，userag-ent都是python，直接限制访问（不能封ip）</li> <li>User-agen模拟firefox，获取ip代理<br>
发现ip变化，直接要求登录才能访问</li> <li>注册账号，每次请求带cookie或者token<br>
健全账号体系，即A只能访问好友的信息</li> <li>注册多个账号，多个账号联合爬取<br>
请求过于频繁，进一步加剧ip访问频率限制</li> <li>模仿人请求，限制请求速度<br>
弹出验证码，让识别验证码</li> <li>通过各种手段识别验证码<br>
增加动态网站，数据通过js动态加载，增加网络分析复杂度，发现大量请求只请求html，不请求image和CSS</li> <li>通过selenium和phantomjs完全模拟浏览器操作<br>
12成本太高，放弃了！！！！</li></ul> <h3 id="处理"><a href="#处理" aria-hidden="true" class="header-anchor">#</a> 处理</h3> <p>BS4,pyQuery,lxml等解析DOM和文件涉及到寻找属性定位xpath,seletor,css定位
最后产生一个自己想要的数据结构</p> <h3 id="存储"><a href="#存储" aria-hidden="true" class="header-anchor">#</a> 存储</h3> <p>拿到这个结构的时候，存到数据库。<br>
pymysql(推荐),aiomysql(异步),存为文件(FileIO)scrapy的pipline,推送消息等等
twisted+pymysql(手动异步)while+eventloop驱动</p> <h3 id="去重"><a href="#去重" aria-hidden="true" class="header-anchor">#</a> 去重</h3> <p>爬虫去重策略</p> <ol><li>将访问过的url保存到数据库中</li> <li>将访问过的url保存到set中，只需要<em>O</em>(1)的代价就可以查询url极限100000000*2byte*50个字符/1024/1024/1024=9G</li> <li>url经过md5等方法哈希后保存到set中</li> <li>用bitmap方法，将访问过的url通过hash函数映射到某一</li> <li>bloomfilter方法对bitmap进行改进，多重hash函数降低冲突</li></ol> <div class="danger custom-block"><p class="custom-block-title">留坑</p> <p>布隆过滤器</p></div> <h2 id="请求-2"><a href="#请求-2" aria-hidden="true" class="header-anchor">#</a> 请求</h2> <h3 id="requests"><a href="#requests" aria-hidden="true" class="header-anchor">#</a> requests</h3> <p>request的基本使用<br>
返回的是一个
一般post之前要查看一下正常的post有没有加密，要不要重写，</p> <div class="danger custom-block"><p class="custom-block-title">留坑</p> <p>js断点调试fiddler抓包</p></div> <h4 id="get-post"><a href="#get-post" aria-hidden="true" class="header-anchor">#</a> get()&amp;post()</h4> <ol><li>get(url,参数),写图片
返回的是一个response对象，包含状态码请求成功与否等等</li></ol> <div class="language-py extra-class"><pre class="language-py"><code>    data<span class="token operator">=</span><span class="token punctuation">{</span>
        <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;zhizhi&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span><span class="token number">20</span>
    <span class="token punctuation">}</span>
    files<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;files&quot;</span><span class="token punctuation">:</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">&quot;baidu.png&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;rb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
    res<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;http://www.httpbin.org/get&quot;</span><span class="token punctuation">,</span>params<span class="token operator">=</span>data<span class="token punctuation">)</span><span class="token comment">#构造一个参数并传进去</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token comment">#直接返回字符串</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#直接解析json</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>contnet<span class="token punctuation">)</span><span class="token comment">#返回网页原始内容</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res0<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span><span class="token comment">#请求的状态码</span>
    res0<span class="token punctuation">.</span>encoding<span class="token operator">=</span><span class="token string">&quot;utf-8&quot;</span><span class="token comment">#把网页的编码转换</span>
    res1<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;https://www.baidu.com/img/bd_logo1.png&quot;</span><span class="token punctuation">)</span>
    <span class="token builtin">len</span><span class="token punctuation">(</span>res1<span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token comment">#图片的二进制</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">&quot;baidu.png&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;wb&quot;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span><span class="token comment">#写二进制图片</span>
        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>res1<span class="token punctuation">.</span>content<span class="token punctuation">)</span>
</code></pre></div><ol start="2"><li>使用header</li></ol> <div class="language-py extra-class"><pre class="language-py"><code>headers<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;Referer&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;https://www.zhihu.com/signup?next=%2F&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;User-Agent&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.102 Safari/537.36&quot;</span><span class="token punctuation">}</span>
res3<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;https://www.zhihu.com&quot;</span><span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span><span class="token comment">#添加headers,像某呼这种不加header就不给访问</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>res3<span class="token punctuation">.</span>text<span class="token punctuation">)</span>

</code></pre></div><ol start="3"><li>传入文件并使用cookie
<br>data被传入了cookie中可以访问了</li></ol> <div class="language-py extra-class"><pre class="language-py"><code>res4 <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">&quot;http://www.httpbin.org/post&quot;</span><span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">,</span> files<span class="token operator">=</span>files<span class="token punctuation">)</span>
 <span class="token comment"># 构造一个form并传进去</span>
pprint<span class="token punctuation">(</span>res4<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>res4<span class="token punctuation">.</span>cookies<span class="token punctuation">)</span>
<span class="token keyword">for</span> k<span class="token punctuation">,</span>v <span class="token keyword">in</span> res4<span class="token punctuation">.</span>cookies<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span><span class="token string">&quot;:&quot;</span><span class="token punctuation">,</span>v<span class="token punctuation">)</span>
</code></pre></div><ol start="4"><li>session维持会话，一般session会很久</li></ol> <div class="language-py extra-class"><pre class="language-py"><code>s<span class="token operator">=</span>requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#维持会话</span>
s<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;http://www.httpbin.org/cookies/set/abc/svsvdhasb&quot;</span><span class="token punctuation">,</span>verify<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
<span class="token comment"># 不进行证书验证，可使用cert=(&quot;path/server.crt&quot;,&quot;path/ket&quot;)进行证书验证</span>
res5<span class="token operator">=</span>s<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;http://www.httpbin.org/cookies&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>res5<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
</code></pre></div><ol start="5"><li>使用ip代理
常用的代理有西刺也可以自己买</li></ol> <div class="language-py extra-class"><pre class="language-py"><code>proxies<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;https&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;127.0.0.1:9900&quot;</span><span class="token punctuation">}</span><span class="token comment">#使用代理</span>
res6<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;http://www.httpbin.org/get&quot;</span><span class="token punctuation">,</span>proxies<span class="token operator">=</span>proxies<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>res6<span class="token punctuation">.</span>content<span class="token punctuation">)</span>
</code></pre></div><h3 id="selenium"><a href="#selenium" aria-hidden="true" class="header-anchor">#</a> selenium</h3> <p>selenium浏览器驱动。<br>当某些网页动态加载js的时候(淘宝)我们需要程序去执行js，(效率自然会低一些)这就是selenium的作用
phantomjs(无界面浏览器)也行但是在多进程的情况下性能下降严重。
<br>
使用之前先下载一个driver<a href="https://npm.taobao.org/mirrors/chromedriver/2.34/">淘宝镜像</a></p> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
broswer<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'http://www.baidu.com'</span><span class="token punctuation">)</span><span class="token comment">#打开</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>broswer<span class="token punctuation">.</span>page_source<span class="token punctuation">)</span> <span class="token comment"># 拿到F12的代码(经过渲染的)</span>
broswer<span class="token punctuation">.</span>maximize_window<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#最大化窗口</span>
broswer<span class="token punctuation">.</span>set_window_size<span class="token punctuation">(</span><span class="token number">600</span><span class="token punctuation">,</span><span class="token number">800</span><span class="token punctuation">)</span><span class="token comment">#设置窗口大小</span>
broswer<span class="token punctuation">.</span>back<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#后退一步</span>
broswer<span class="token punctuation">.</span>forward<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#前进一步</span>
broswer<span class="token punctuation">.</span>refresh<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#刷新</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>broswer<span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token comment">#拿到浏览器的标题</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>broswer<span class="token punctuation">.</span>current_url<span class="token punctuation">)</span><span class="token comment">#拿到url</span>
broswer<span class="token punctuation">.</span>get_cookies<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#拿到cookie</span>
broswer<span class="token punctuation">.</span>delete_all_cookies<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#删除所有的cookie</span>
broswer<span class="token punctuation">.</span>add_cookie<span class="token punctuation">(</span><span class="token punctuation">{</span>k<span class="token operator">-</span>v<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">#增加cookie</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">可用的驱动</p> <p>webdriver.Firefox<br>
webdriver.FirefoxProfile<br>
webdriver.Chrome<br>
webdriver.ChromeOptions<br>
webdriver.Ie<br>
webdriver.Opera<br>
webdriver.PhantomJS<br>
webdriver.Remote<br>
webdriver.DesiredCapabilities<br>
webdriver.ActionChains<br>
webdriver.TouchActions<br></p></div> <h4 id="查找元素"><a href="#查找元素" aria-hidden="true" class="header-anchor">#</a> 查找元素</h4> <p>不建议使用自带的，因为会拖慢速度，性能会变差。<br>
可以用其他的包lxml bs等代替，不过有时候不能代替</p> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">print</span><span class="token punctuation">(</span>broswer<span class="token punctuation">.</span>find_element_by_id<span class="token punctuation">(</span>id_<span class="token operator">=</span><span class="token string">&quot;lg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><ol><li>id定位：find_element_by_id()</li> <li>name定位：find_element_by_name()</li> <li>class定位：find_element_by_class()</li> <li>tag定位：find_element_by_tag_name()</li> <li>link定位：find_element_by_link_text()</li> <li>partial link 定位： find_element_by_partial_link_text()</li> <li>Xpath定位:<br> <ul><li>绝对路径：find_element_by_xpath(&quot;绝对路径&quot;)</li> <li>元素属性：find_element_by_xpath(&quot;//unput[@id='kw']&quot;)</li> <li>层级与属性结合：find_element_by_xpath(&quot;//form[@id='loginForm']/ul/input[1]&quot;)</li> <li>逻辑运算符：find_element_by_xpath(&quot;//input[@id='kw' and@class='s_ipt']&quot;)</li></ul></li> <li>CSS定位：find_element_by_css_selector()</li></ol> <h4 id="通过selenium模拟登陆微博"><a href="#通过selenium模拟登陆微博" aria-hidden="true" class="header-anchor">#</a> 通过selenium模拟登陆微博</h4> <div class="danger custom-block"><p class="custom-block-title">失败了 留坑</p> <p>后面再试，填值的时候填不上</p></div> <h4> 往元素中填值并登陆</h4> <div class="language-py extra-class"><pre class="language-py"><code>ele0<span class="token operator">=</span>broswer<span class="token punctuation">.</span>find_element_by_id<span class="token punctuation">(</span>id_<span class="token operator">=</span><span class="token string">&quot;lg&quot;</span><span class="token punctuation">)</span>
ele<span class="token operator">=</span>broswer<span class="token punctuation">.</span>find_element_by_id<span class="token punctuation">(</span>id_<span class="token operator">=</span><span class="token string">&quot;kw&quot;</span><span class="token punctuation">)</span>
ele<span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span><span class="token string">u&quot;qwe&quot;</span><span class="token punctuation">)</span><span class="token comment">#模拟按键输入：</span>
ele<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#清除文本：</span>
ele<span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span><span class="token string">u&quot;abc&quot;</span><span class="token punctuation">)</span><span class="token comment">#模拟按键输入：</span>
ele1<span class="token operator">=</span>broswer<span class="token punctuation">.</span>find_element_by_class_name<span class="token punctuation">(</span><span class="token string">&quot;bg s_btn&quot;</span><span class="token punctuation">)</span>
ele1<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#单击元素</span>
ele1<span class="token punctuation">.</span>submit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#提交表单（相当于&quot;回车&quot;）</span>
broswer<span class="token punctuation">.</span>execute_script<span class="token punctuation">(</span><span class="token string">'alert(&quot;123&quot;);'</span><span class="token punctuation">)</span><span class="token comment">#执行js</span>
</code></pre></div><p>加载的时候不加载图片(节省性能)，如下设置</p> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver

chrome_options <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>ChromeOptions<span class="token punctuation">(</span><span class="token punctuation">)</span>
prefs <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;profile.managed_default_content_settings.images&quot;</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">}</span>
chrome_options<span class="token punctuation">.</span>add_experimental_option<span class="token punctuation">(</span><span class="token string">&quot;prefs&quot;</span><span class="token punctuation">,</span>prefs<span class="token punctuation">)</span>

driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span>chrome_options<span class="token operator">=</span>chrome_options<span class="token punctuation">)</span>

</code></pre></div><h3 id="aiohttp"><a href="#aiohttp" aria-hidden="true" class="header-anchor">#</a> aiohttp</h3> <p>异步请求的http库</p> <div class="danger custom-block"><p class="custom-block-title">留坑</p> <p>异步等过一两天再整理</p></div> <h2 id="处理-2"><a href="#处理-2" aria-hidden="true" class="header-anchor">#</a> 处理</h2> <p>数据处理就是把DOM的元素内容拿出来</p> <h3 id="beautifulsoup"><a href="#beautifulsoup" aria-hidden="true" class="header-anchor">#</a> BeautifulSoup</h3> <p>对dom进行解析<br>
from bs4 import BeautifulSoup as BS <br>
dom例子</p> <pre><code>      &lt;li id=&quot;note-36396362&quot; data-note-id=&quot;36396362&quot; class=&quot;have-img&quot;&gt;
          &lt;a class=&quot;wrap-img&quot; href=&quot;www.baidu.com&quot; target=&quot;_blank&quot;&gt;
            &lt;img class=&quot;  img-blur-done&quot; src=&quot;//upload-images.jianshu.io/upload_images/12240181-bb9399878eae6ddd?imageMogr2/auto-orient/strip|imageView2/1/w/360/h/240&quot; alt=&quot;120&quot;&gt;
          &lt;/a&gt;
        &lt;div class=&quot;content&quot;&gt;
          &lt;a class=&quot;title&quot; target=&quot;_blank&quot; href=&quot;www.baidu.com&quot;&gt;罗永浩最爱的“软件”下凡了！ 让你体验高效记录的感觉&lt;/a&gt;
          &lt;p class=&quot;abstract&quot;&gt;
            听说锤子又发布了新产品！ 锤子科技不是一个卖手机的好公司，却是一个搞软件的领头军，旗下的闪念胶囊和BigBang一直被赞扬，网友戏称： 锤子有三...
          &lt;/p&gt;
          &lt;div class=&quot;meta&quot;&gt;
            &lt;a class=&quot;nickname&quot; target=&quot;_blank&quot; href=&quot;/u/00385c37e5de&quot;&gt;Tools指南&lt;/a&gt;
              &lt;a target=&quot;_blank&quot; href=&quot;www.baidu.com#comments&quot;&gt;
                &lt;i class=&quot;iconfont ic-list-comments&quot;&gt;&lt;/i&gt; 3
      &lt;/a&gt;      &lt;span&gt;&lt;i class=&quot;iconfont ic-list-like&quot;&gt;&lt;/i&gt; 46&lt;/span&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/li&gt;
</code></pre> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup <span class="token keyword">as</span> BS
soup<span class="token operator">=</span>BS<span class="token punctuation">(</span>dom<span class="token punctuation">,</span><span class="token string">'lxml'</span><span class="token punctuation">)</span><span class="token comment">#生成了一个soup对象使用unicode编码</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">注意指定编码</p> <p>默认lxml<br>
BeautifulSoup(markup, &quot;lxml&quot;)速度快<br>
BeautifulSoup(markup, &quot;html.parser&quot;)系统自带<br>
BeautifulSoup(markup, &quot;xml&quot;)唯一支持xml<br>
BeautifulSoup(markup, &quot;html5lib&quot;)生成h5浏览器方式解析</p></div> <p>tag.name标签名称可嵌套soup.head.tittle<br>
tag.attributes标签后面的属性,可添加或者修改,和字典一样<br>
多值属性,class最多,每个tag可能用多个css<br>
其他的rel , rev , accept-charset , headers , accesskey返回一个list非多值属性会返回str<br>
将tag转换为str的时候多值属性会自动合为由空格隔开的字符串,xml没有多值</p> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">print</span><span class="token punctuation">(</span>soup<span class="token punctuation">.</span>name<span class="token punctuation">,</span>soup<span class="token punctuation">.</span>attrs<span class="token punctuation">)</span><span class="token comment">#获取名字和属性</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span>class_<span class="token operator">=</span><span class="token string">&quot;meta&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">#获取了class为meta的第一个元素</span>
soup<span class="token punctuation">.</span>find_all_next<span class="token punctuation">(</span>class_<span class="token operator">=</span><span class="token string">&quot;meta&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">#获这也元素的下一个邻居</span>
soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span>class_<span class="token operator">=</span><span class="token string">&quot;meta&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#列表获取所有meta的元素</span>
tag<span class="token punctuation">.</span>parent<span class="token comment">#获得父节点beautifulsoup父节点为None</span>
tag<span class="token punctuation">.</span>descendants<span class="token comment">#子孙节点的递归迭代对象</span>
tag<span class="token punctuation">.</span>chlidren<span class="token comment">#是包含子节点对象对象对象的可迭代对象</span>
</code></pre></div><table><thead><tr><th>方法</th> <th style="text-align:center">参数</th> <th style="text-align:right">返回</th></tr></thead> <tbody><tr><td>find</td> <td style="text-align:center">(self, name, attrs, recursive, text,.… Tag</td> <td style="text-align:right">1</td></tr> <tr><td>find_all</td> <td style="text-align:center">(self, name, attrs, recursive, te.. Tag</td> <td style="text-align:right">2</td></tr> <tr><td>find_all_previous</td> <td style="text-align:center">(self, name, att.. PageElement</td> <td style="text-align:right">3</td></tr> <tr><td>find_next</td> <td style="text-align:center">(self, name, attrs, text.. PageElement</td> <td style="text-align:right">4</td></tr> <tr><td>find_next_sibling</td> <td style="text-align:center">(self, name, att.. PageElement</td> <td style="text-align:right">5</td></tr> <tr><td>find_next_siblings</td> <td style="text-align:center">(self, name, at.. PageElement</td> <td style="text-align:right">6</td></tr> <tr><td>find_parent</td> <td style="text-align:center">(self, name, attrs, kw.. PageElement</td> <td style="text-align:right">7</td></tr> <tr><td>find_parents</td> <td style="text-align:center">(self, name, attrs,1.. PageElement</td> <td style="text-align:right">8</td></tr> <tr><td>find_previous</td> <td style="text-align:center">(self, name, attrs,.. PageElement</td> <td style="text-align:right">9</td></tr> <tr><td>find_previous_sibling</td> <td style="text-align:center">(self, name,.… PageElement</td> <td style="text-align:right">10</td></tr> <tr><td>find previous siblings</td> <td style="text-align:center">(self, name.. PageElement</td> <td style="text-align:right">11</td></tr></tbody></table> <p>这是节点的一些属性，可以获取内容</p> <div class="warning custom-block"><p class="custom-block-title">WARNING</p> <p>注意顿号以及换行也算节点<br>
class_用来标识css可以部分匹配也可全匹配,全匹配的时候注意顺序若不一样无法匹配</p></div> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">print</span><span class="token punctuation">(</span>soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span>class_<span class="token operator">=</span><span class="token string">&quot;meta&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">#获取了class为meta的第一个元素</span>
soup<span class="token punctuation">.</span>find_all_next<span class="token punctuation">(</span>class_<span class="token operator">=</span><span class="token string">&quot;meta&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">#获这也元素的下一个邻居</span>
soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span>class_<span class="token operator">=</span><span class="token string">&quot;meta&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
soup1<span class="token operator">=</span>soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'p'</span><span class="token punctuation">,</span>class_<span class="token operator">=</span><span class="token string">&quot;abstract&quot;</span><span class="token punctuation">)</span><span class="token comment">#获取标签为p，class=&quot;abstract&quot;的元素</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>soup<span class="token punctuation">.</span>string<span class="token punctuation">)</span><span class="token comment">#没有子节点的情况下得到字符串</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>soup1<span class="token punctuation">.</span>strings<span class="token punctuation">)</span><span class="token comment">#得到多个字符串 列表</span>
soup1<span class="token operator">=</span>soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span>class_<span class="token operator">=</span><span class="token string">&quot;content&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>soup1<span class="token punctuation">.</span>contents<span class="token punctuation">)</span><span class="token comment">#节点的元素，是个列表</span>
soup<span class="token punctuation">.</span>get_text<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#返回所有的及其孩子的文本</span>
soup<span class="token punctuation">.</span>prettify<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#自动对齐补全html</span>
</code></pre></div><h3 id="pyquery"><a href="#pyquery" aria-hidden="true" class="header-anchor">#</a> pyQuery</h3> <p>pip安装pyQuery</p> <h3>打开</h3> <p>pq=PyQuery(&quot;http://www.baidu.com&quot;)#也可以直接打开文件pq=PyQuery(&quot;aa.html&quot;)</p> <table><thead><tr><th>类型</th> <th style="text-align:center">形式</th> <th style="text-align:right">含义</th></tr></thead> <tbody><tr><td>.class</td> <td style="text-align:center">.color</td> <td style="text-align:right">选择class=&quot;color”的所有元素</td></tr> <tr><td>#id</td> <td style="text-align:center">#info</td> <td style="text-align:right">选择id=&quot;info”的所有元素</td></tr> <tr><td>*</td> <td style="text-align:center">*</td> <td style="text-align:right">选择所有元素</td></tr> <tr><td>element</td> <td style="text-align:center">p</td> <td style="text-align:right">选择所有的p元素</td></tr> <tr><td>element,element</td> <td style="text-align:center">div,pe</td> <td style="text-align:right">选择所有div元素和所有p元素</td></tr> <tr><td>elemente lement</td> <td style="text-align:center">div pe</td> <td style="text-align:right">选择所有div元素内所有p元素</td></tr> <tr><td>[attribute]</td> <td style="text-align:center">[target]</td> <td style="text-align:right">选择带有targe属性的所有元素。</td></tr> <tr><td>[arrtibute=value]</td> <td style="text-align:center">[target=_blank]</td> <td style="text-align:right">选择 target=&quot;_blank”的所有元素</td></tr></tbody></table> <p>可以使用伪类<br>
可调用的函数<br></p> <ul><li>pq.find()#发现标签</li> <li>pq.parent()#发现标签的父标签</li> <li>pq.parents()#递归发现父标签</li> <li>pq.children()#发现子标签</li> <li>pq.text()#获取所有文本,忽略标签</li></ul> <div class="warning custom-block"><p class="custom-block-title">WARNING</p> <p>pq本身是具有标签的字符串
pq.html()不含本身的标签</p></div> <p>程序如下<br></p> <div class="language-py extra-class"><pre class="language-py"><code>使用上面的dom
x<span class="token operator">=</span>pq<span class="token punctuation">(</span><span class="token string">'li a'</span><span class="token punctuation">)</span>
pq<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>
pq<span class="token punctuation">.</span>parent<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>
pq<span class="token punctuation">.</span>parents<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>
pq<span class="token punctuation">.</span>children<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>attr<span class="token punctuation">(</span><span class="token string">&quot;target&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;_blank&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>attr<span class="token punctuation">.</span>target<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>结果</p> <pre><code>&lt;a class=&quot;wrap-img&quot; href=&quot;www.baidu.com&quot; target=&quot;_blank&quot;&gt;
      &lt;img class=&quot;  img-blur-done&quot; src=&quot;//upload-images.jianshu.io/upload_images/12240181-bb9399878eae6ddd?imageMogr2/auto-orient/strip|imageView2/1/w/360/h/240&quot; alt=&quot;120&quot;/&gt;
    &lt;/a&gt;
  &lt;a class=&quot;title&quot; target=&quot;_blank&quot; href=&quot;www.baidu.com&quot;&gt;罗永浩最爱的“软件”下凡了！ 让你体验高效记录的感觉&lt;/a&gt;
    &lt;a class=&quot;nickname&quot; target=&quot;_blank&quot; href=&quot;/u/00385c37e5de&quot;&gt;Tools指南&lt;/a&gt;
        &lt;a target=&quot;_blank&quot; href=&quot;www.baidu.com#comments&quot;&gt;
          &lt;i class=&quot;iconfont ic-list-comments&quot;/&gt; 3
&lt;/a&gt;
_blank
 罗永浩最爱的“软件”下凡了！ 让你体验高效记录的感觉 Tools指南 3
</code></pre> <h3 id="xpath-cssselector"><a href="#xpath-cssselector" aria-hidden="true" class="header-anchor">#</a> Xpath&amp;CssSelector</h3> <p>利用这些语法定位dom的元素
F12开发者模式，直接复制注意js渲染会扰乱xpath和css</p> <div align="center"><img src="/assets/img/pachong1.798cabeb.png"></div> <h3>Xpath</h3> <table><thead><tr><th>类型</th> <th style="text-align:right">形式</th></tr></thead> <tbody><tr><td>article</td> <td style="text-align:right">选取所有article元素的所有子节点</td></tr> <tr><td>/article</td> <td style="text-align:right">选取根元素article</td></tr> <tr><td>article/a</td> <td style="text-align:right">选取所有属于article的子元素的a元素</td></tr> <tr><td>//div</td> <td style="text-align:right">选取所有div子元素（不论出现在文档任何地方）</td></tr> <tr><td>article//div</td> <td style="text-align:right">选取所有属于article元素的后代的div元素，不管它出现在article之下的任何位置</td></tr> <tr><td>//@class</td> <td style="text-align:right">选区这个标签下所有名为class的属性</td></tr> <tr><td>/a[@href=&quot;link2.html&quot;]</td> <td style="text-align:right">选取所有href为&quot;link2.html&quot;的a标签</td></tr> <tr><td>@href</td> <td style="text-align:right">拿到href标签</td></tr> <tr><td>?/text()</td> <td style="text-align:right">?元素下的文本</td></tr></tbody></table> <h3>css选择器</h3> <table><thead><tr><th>类型</th> <th style="text-align:right">形式</th></tr></thead> <tbody><tr><td>*</td> <td style="text-align:right">选择所有节点</td></tr> <tr><td>#container</td> <td style="text-align:right">选择id为container的节点</td></tr> <tr><td>.container</td> <td style="text-align:right">选取所有class包含container的节点</td></tr> <tr><td>li a</td> <td style="text-align:right">选取所有i下的所有a节点</td></tr> <tr><td>ul+p</td> <td style="text-align:right">选择l后面的第一个p元素</td></tr> <tr><td>div#container&gt;ul</td> <td style="text-align:right">选取id为container的div的第一个ul子元素</td></tr> <tr><td>ul~p</td> <td style="text-align:right">选取与ul相邻的所有p元素</td></tr> <tr><td>a[title]</td> <td style="text-align:right">选取所有有title属性的a元素</td></tr> <tr><td>a[href=&quot;http:/jobbole.com&quot;]</td> <td style="text-align:right">选取所有href属性为jobbole.com值的a元素</td></tr> <tr><td>a[href*=&quot;jobole&quot;]</td> <td style="text-align:right">选取所有href属性包含jobbole的a元素</td></tr> <tr><td>a[href^=&quot;http&quot;]</td> <td style="text-align:right">选取所有href属性值以http开头的a元素</td></tr> <tr><td>a[href$=&quot;.jpg”]</td> <td style="text-align:right">选取所有href属性值以.jpg结尾的a元素</td></tr> <tr><td>input[type=radio]:checked</td> <td style="text-align:right">选择选中的radio的元素</td></tr> <tr><td>div:not(#container)</td> <td style="text-align:right">选取所有id非container的div属性</td></tr> <tr><td>li:nth-child(3)</td> <td style="text-align:right">选取第三个i元素</td></tr> <tr><td>tr:nth-child(2n)</td> <td style="text-align:right">第偶数个tr</td></tr> <tr><td>a::text</td> <td style="text-align:right">拿到标签的文本</td></tr> <tr><td>a::attr(href)</td> <td style="text-align:right">拿到标签href属性</td></tr></tbody></table> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree
html<span class="token operator">=</span>etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>dom<span class="token punctuation">)</span><span class="token comment">#初始化，也可初始化本地网页etree.parse('test.html')</span>
result <span class="token operator">=</span> etree<span class="token punctuation">.</span>tostring<span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token comment">#放入lxml中</span>
result<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token comment">#对这个html进行编码</span>

x<span class="token operator">=</span>html<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@class=&quot;content&quot;]/text()'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
y<span class="token operator">=</span>html<span class="token punctuation">.</span>cssselect<span class="token punctuation">(</span><span class="token string">'#note-36396362 &gt; div &gt;.title'</span><span class="token punctuation">)</span><span class="token comment">#拿到所有class为title的元素</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> y<span class="token punctuation">:</span><span class="token comment">#是个列表</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>text<span class="token punctuation">,</span>i<span class="token punctuation">.</span>attrib<span class="token punctuation">[</span><span class="token string">'href'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><div class="danger custom-block"><p class="custom-block-title">注意</p> <p>空格和换行符也算一个文本，看结果</p></div> <p>结果</p> <pre><code>['\n  听说锤子又发布了新产品！ 锤子科技不是一个卖手机的好公司，
却是一个搞软件的领头军，旗下的闪念胶囊和BigBang一直被赞扬，网友戏称：
锤子有三...\n    ', '\n    ', '\n    ', '\n  ']
罗永浩最爱的“软件”下凡了！ 让你体验高效记录的感觉 
www.baidu.com
</code></pre> <h2 id="存储-2"><a href="#存储-2" aria-hidden="true" class="header-anchor">#</a> 存储</h2> <h3 id="pymysql"><a href="#pymysql" aria-hidden="true" class="header-anchor">#</a> pymysql</h3> <ul><li><p>创建连接
参数如下
</p><div align="center"><img src="/assets/img/dbpara.b9e08d7e.png"></div><p></p></li> <li><p>创建游标<br>
可选择字典形式<br></p></li> <li><p>构造sql语句<br>
善用str.format<br></p></li> <li><p>执行sql<br>
注意错误回滚<br></p></li> <li><p>拿回结果<br>
注意指针的位置<br></p></li></ul> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">import</span> pymysql

conn<span class="token operator">=</span>pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span>
                    user<span class="token operator">=</span><span class="token string">'root'</span><span class="token punctuation">,</span>
                    password<span class="token operator">=</span><span class="token string">'不给看！！！'</span><span class="token punctuation">,</span>
                    database<span class="token operator">=</span><span class="token string">'aiosql'</span><span class="token punctuation">,</span>
                    charset<span class="token operator">=</span><span class="token string">'utf8mb4'</span><span class="token punctuation">)</span>
cur<span class="token operator">=</span>conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span>cursor<span class="token operator">=</span>pymysql<span class="token punctuation">.</span>cursors<span class="token punctuation">.</span>DictCursor<span class="token punctuation">)</span>
<span class="token comment">#使用DictCursor返回不再是元组是一个代映射的字典</span>
sql<span class="token operator">=</span><span class="token string">'select * from aio'</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    reslen<span class="token operator">=</span>cur<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token comment">#执行sql语句</span>
    conn<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#注意要提交</span>
<span class="token keyword">except</span><span class="token punctuation">:</span><span class="token comment">#发生错误</span>
    conn<span class="token punctuation">.</span>rollback<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#回滚</span>
    cur<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#关闭</span>
<span class="token comment">#行为单位移动</span>
cur<span class="token punctuation">.</span>description<span class="token comment">#光标详情描述</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>cur<span class="token punctuation">.</span>lastrowid<span class="token punctuation">)</span><span class="token comment">#光标</span>
cur<span class="token punctuation">.</span>scroll<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>mode<span class="token operator">=</span><span class="token string">'absolute'</span><span class="token punctuation">)</span><span class="token comment">#指针指向第二条</span>
cur<span class="token punctuation">.</span>scroll<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>mode<span class="token operator">=</span><span class="token string">'relative'</span><span class="token punctuation">)</span><span class="token comment">#指针相对向后移动两条</span>
one<span class="token operator">=</span>cur<span class="token punctuation">.</span>fetchone<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#结果的一条光标后移1</span>
<span class="token builtin">all</span><span class="token operator">=</span>cur<span class="token punctuation">.</span>fetchmany<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token comment">#拿出三条后移3</span>
many<span class="token operator">=</span>cur<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#拿出三条，移到底</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>one<span class="token punctuation">,</span><span class="token builtin">all</span><span class="token punctuation">,</span>many<span class="token punctuation">)</span>
</code></pre></div><div class="danger custom-block"><p class="custom-block-title">有坑</p> <p>插入数据库要保证健壮性，特殊字符提前处理比如去掉单引号，反斜杠，编码字符等<br>
四字节字符入库时\xF0\x9F\x99\x8F像这样 <br>
首先修改 my.ini 编码集为utf8mb4 数据库和表改为utf8mb4<br>
还不行的话删库重新新建选择字符集utf8mb4<br>
连接数据库的时候改为utf8mb4重启mysqld服务</p></div> <h3 id="pymongo"><a href="#pymongo" aria-hidden="true" class="header-anchor">#</a> PyMongo</h3> <p><strong><em>pip install pymongo</em></strong><br>
mongo的操作看<a href="/blog/back/数据相关.html#mongodb">这里</a></p><h4>连接</h4><p></p> <p>简写(默认连接本地)<br>
client=MongoClient()<br>
指定端囗和地址<br>
client=MongoClient(localhost，27017)<br>
使用URI <br>
client=MongoClient(mongodb://localhost：27017/&quot;)<br>
client.PORT,client.HOST,client.list_database_names()<br>
db=client.mydb # 使用mydb，没有就自动创建<br>
myset=db.my_set<br></p> <div class="tip custom-block"><p class="custom-block-title">关闭</p> <p>关闭数据库的时候调用client.close()之后仍然能使用属性，比如在打印一次也能打印出来，yinweimongo默认有个连接池，只要没满随时都能连</p></div> <h4>增删改查</h4> <ul><li>插入<br> <strong><em>my_set.insert([{&quot;name&quot;:&quot;zhangsan&quot;,&quot;age&quot;:18},{&quot;name&quot;:&quot;lilin&quot;,&quot;age&quot;:18}])</em></strong><br> <strong><em>my_set.save({&quot;name&quot;:&quot;zhangsan&quot;,&quot;age&quot;:18})</em></strong><br>
save的时候他会遍历，但是insert不会，所以insert快一些<br></li> <li>查询这个集合所有的数据(需要用for遍历)
<strong><em>my_set.find()</em></strong><br></li> <li>查找名字为zhangsan的数据(需要用for遍历)<br> <strong><em>my_set.find({&quot;name&quot;:&quot;zhangsan&quot;})</em></strong><br></li> <li>取出这条记录的'id'依此类推可以往后取<br> <strong><em>id=my_set.find({&quot;name&quot;:&quot;zhangsan&quot;})['id']</em></strong><br></li> <li>移除这个记录的id<br> <strong><em>my_set.remove(id)</em></strong><br></li> <li>把name为zhangsan的age改为20<br> <strong><em>my_set.update({&quot;name&quot;:&quot;zhangsan&quot;},{'$set':{&quot;age&quot;:20}})</em></strong><br></li> <li>移除张三这个数据的全部记录<br> <strong><em>my_set.remove({'name': 'zhangsan'})</em></strong><br></li> <li>删掉这个库<br> <strong><em>db.remove()</em></strong><br></li></ul> <h4>操作和查询符</h4> <ol><li>查询符
<ul><li>&gt;  大于 - $gt</li> <li>&lt;  小于 - $lt</li> <li>&gt;=  大于等于 - $gte</li> <li>&lt;=  小于等于 - $lte</li></ul></li></ol> <ul><li>age大于25的记录
<strong><em>my_set.find({&quot;age&quot;:{&quot;$gt&quot;:25}})</em></strong><br></li></ul> <ol start="2"><li>类型判断<br>
发现字符串类型的name<br> <strong><em>my_set.find({'name':{'$type':2}})</em></strong><br> <div align="center">类型对照表<br></div><br></li></ol> <table><thead><tr><th>类型</th> <th style="text-align:right">码</th></tr></thead> <tbody><tr><td>Double</td> <td style="text-align:right">类型代码 1</td></tr> <tr><td>String</td> <td style="text-align:right">类型代码 2</td></tr> <tr><td>Object</td> <td style="text-align:right">类型代码 3</td></tr> <tr><td>Array</td> <td style="text-align:right">类型代码 4</td></tr> <tr><td>Binary data</td> <td style="text-align:right">类型代码 5</td></tr> <tr><td>Boolean</td> <td style="text-align:right">类型代码 8</td></tr> <tr><td>Date</td> <td style="text-align:right">类型代码 9</td></tr> <tr><td>Null</td> <td style="text-align:right">类型代码 10</td></tr> <tr><td>Regular Expression</td> <td style="text-align:right">类型代码 11</td></tr> <tr><td>JavaScript</td> <td style="text-align:right">类型代码 13</td></tr> <tr><td>Symbol</td> <td style="text-align:right">类型代码 14</td></tr> <tr><td>JavaScript (with scope)</td> <td style="text-align:right">类型代码 15</td></tr> <tr><td>32-bit integer</td> <td style="text-align:right">类型代码 16</td></tr> <tr><td>Timestamp</td> <td style="text-align:right">类型代码 17</td></tr> <tr><td>64-bit integer</td> <td style="text-align:right">类型代码 18</td></tr> <tr><td>Min key</td> <td style="text-align:right">类型代码 255</td></tr> <tr><td>Max key</td> <td style="text-align:right">类型代码 127</td></tr></tbody></table> <ol start="3"><li>条件查询</li></ol> <ul><li><p>排序<br>
age升序查询<br> <strong><em>my_set.find().sort([(&quot;age&quot;,1)])</em></strong><br></p></li> <li><p>读取
跳过两条之后读六条<br> <strong><em>my_set.find().skip(2).limit(6)</em></strong><br></p></li> <li><p>in<br>
发现年龄（20，30，53）中的数据<br></p></li></ul> <p><strong><em>my_set.find({&quot;age&quot;:{&quot;$in&quot;:(20,30,35)}})</em></strong><br></p> <ul><li>or<br></li></ul> <p>发现age是20或35的数据
<br></p> <p><strong><em>my_set.find({&quot;$or&quot;:[{&quot;age&quot;:20},{&quot;age&quot;:35}]})</em></strong><br></p> <ul><li>all<br>
查询序列的包含<br></li></ul> <p>dic = {&quot;name&quot;:&quot;xiahong&quot;,&quot;age&quot;:18,&quot;li&quot;:[1,2,3]}<br>
dic2 = {&quot;name&quot;:&quot;xiaoming&quot;,&quot;age&quot;:18,&quot;li&quot;:[1,2,3,4,5,6]}<br></p> <p><strong><em>my_set.find({'li':{'$all':[1,2,3,4]}})</em></strong><br>
结果只会出现dic2</p> <ul><li>push[ALL]
更改序列<br>
单个值: my_set.update({'name':&quot;xiaohong&quot;}, {'$push':{'li':[4]}})<br>
多个追加: my_set.update({'name':&quot;xiaohong&quot;}, {'$pushAll':{'li':[4,5]}})<br>
dic = {&quot;name&quot;:&quot;xiahong&quot;,&quot;age&quot;:18,&quot;li&quot;:[1,2,3,4,4,5]}</li> <li>pop/pullAll
单个值: my_set.update({'name':&quot;xiaohong&quot;}, {'$pop':{'li':[4]}})<br>
去除多个: my_set.update({'name':&quot;xiaohong&quot;}, {'$pullAll':{'li':[4,5]}})<br>
dic = {&quot;name&quot;:&quot;xiahong&quot;,&quot;age&quot;:18,&quot;li&quot;:[1,2,3]}</li> <li>多级目录操作<br>
取的时候用.连接，结果用['字典调用']方式连接<br>
查找a属性的b属性的c属性值为5的数据<br> <strong><em>my_set.find(a.b.c:5)</em></strong><br>
拿到结果的a属性的b属性的c属性值<br> <strong><em>res['a']['b']['c']</em></strong><br></li></ul> <div class="tip custom-block"><p class="custom-block-title">提示</p> <p>update,$set等也是这么寻找</p></div> <h3 id="redis"><a href="#redis" aria-hidden="true" class="header-anchor">#</a> redis</h3> <h4>pip install redis</h4><br> <h4>连接</h4> <h4>连接</h4> <h4>连接</h4> <h4>连接</h4> <h4>连接</h4> <h3 id="aiomysql"><a href="#aiomysql" aria-hidden="true" class="header-anchor">#</a> aiomysql</h3> <p>依赖<br></p> <ul><li>Python3.5+</li> <li>asyncio</li> <li>PyMySQL<br>
eventloop+while True模式进行插入异步进行</li></ul> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">import</span> asyncio
<span class="token keyword">from</span> aiomysql <span class="token keyword">import</span> create_pool

<span class="token keyword">import</span> aiohttp

loop<span class="token operator">=</span>asyncio<span class="token punctuation">.</span>get_event_loop<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">go</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">async</span> <span class="token keyword">with</span> create_pool<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span>port<span class="token operator">=</span><span class="token number">3306</span><span class="token punctuation">,</span>user<span class="token operator">=</span><span class="token string">'root'</span><span class="token punctuation">,</span>password<span class="token operator">=</span><span class="token string">'1118'</span><span class="token punctuation">,</span>db<span class="token operator">=</span><span class="token string">'aiosql'</span><span class="token punctuation">,</span>charset<span class="token operator">=</span><span class="token string">'utf8mb4'</span><span class="token punctuation">,</span>loop<span class="token operator">=</span>loop<span class="token punctuation">)</span> <span class="token keyword">as</span> pool<span class="token punctuation">:</span>
        <span class="token keyword">async</span> <span class="token keyword">with</span> pool<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> conn<span class="token punctuation">:</span><span class="token comment">#获得pool</span>
            <span class="token keyword">async</span> <span class="token keyword">with</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> cur<span class="token punctuation">:</span><span class="token comment">#创建游标</span>
                <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment">#异步运行了一百次这个sql语句</span>
                    <span class="token keyword">await</span> cur<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'select * from aio limit 1;'</span><span class="token punctuation">)</span>
                    value<span class="token operator">=</span> <span class="token keyword">await</span> cur<span class="token punctuation">.</span>fetchone<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>

loop<span class="token punctuation">.</span>run_until_complete<span class="token punctuation">(</span>go<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>通过连接池来连接</p> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span>loop<span class="token punctuation">)</span><span class="token punctuation">:</span>
    pool<span class="token operator">=</span><span class="token keyword">await</span> create_pool<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span>port<span class="token operator">=</span><span class="token number">3306</span><span class="token punctuation">,</span>user<span class="token operator">=</span><span class="token string">'root'</span><span class="token punctuation">,</span>password<span class="token operator">=</span><span class="token string">'1118'</span><span class="token punctuation">,</span>db<span class="token operator">=</span><span class="token string">'aiosql'</span><span class="token punctuation">,</span>charset<span class="token operator">=</span><span class="token string">'utf8mb4'</span><span class="token punctuation">,</span>loop<span class="token operator">=</span>loop<span class="token punctuation">)</span>
    <span class="token keyword">async</span> <span class="token keyword">with</span> pool<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> conn<span class="token punctuation">:</span>
        <span class="token keyword">async</span> <span class="token keyword">with</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> cur<span class="token punctuation">:</span>
            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1000000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">await</span> cur<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'select * from aio limit 1;'</span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span>cur<span class="token punctuation">.</span>description<span class="token punctuation">)</span>
                <span class="token punctuation">(</span>r<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token keyword">await</span> cur<span class="token punctuation">.</span>fetchone<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>
    pool<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> pool<span class="token punctuation">.</span>wait_closed<span class="token punctuation">(</span><span class="token punctuation">)</span>

loop<span class="token operator">=</span>asyncio<span class="token punctuation">.</span>get_event_loop<span class="token punctuation">(</span><span class="token punctuation">)</span>
loop<span class="token punctuation">.</span>run_until_complete<span class="token punctuation">(</span>test<span class="token punctuation">(</span>loop<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="scrapy"><a href="#scrapy" aria-hidden="true" class="header-anchor">#</a> Scrapy</h2> <p>看<a href="/blog/back/python/scrapy%E7%9B%B8%E5%85%B3.html">这里</a>或者下一篇
<div id="vcomments"></div></p></div> <!----> <!----> <!----> <div class="page-edit" data-v-cdcae5a4><!----> <div class="last-updated" data-v-cdcae5a4><span class="prefix" data-v-cdcae5a4>Last Updated: </span> <span class="time" data-v-cdcae5a4>12/29/2019, 3:00:55 PM</span></div></div> <div class="page-nav" data-v-cdcae5a4><p class="inner" data-v-cdcae5a4><!----> <span class="next" data-v-cdcae5a4><a href="/blog/back/python/scrapy相关.html" data-v-cdcae5a4>
          Scrapy(old)
        </a>
        →
      </span></p></div> </div> <div class="valine-wrapper" data-v-63f18ac0><div id="valine" style="display:;" data-v-63f18ac0></div></div> <!----> <!----> <div class="back-to-ceiling" style="right:1rem;bottom:3rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;background-color:rgba(231, 234, 241,.5);display:none;" data-v-41016a8b data-v-41016a8b><i class="iconfont reco-up" data-v-41016a8b></i></div></div></div></div>
    <script src="/assets/js/app.64171550.js" defer></script><script src="/assets/js/18.78f0824a.js" defer></script><script src="/assets/js/38.34e99c36.js" defer></script>
  </body>
</html>
